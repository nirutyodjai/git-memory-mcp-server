{{/*
=============================================================================
ENTERPRISE SECURITY DASHBOARD - INSTALLATION NOTES
Post-Installation Information and Instructions
=============================================================================
*/}}

ğŸš€ NEXUS IDE Security Dashboard has been successfully deployed!

{{- $fullName := include "security-dashboard.fullname" . -}}
{{- $svcPort := .Values.service.port -}}

# =============================================================================
# ğŸ“Š DEPLOYMENT INFORMATION
# =============================================================================

âœ… Release Name: {{ .Release.Name }}
âœ… Namespace: {{ .Release.Namespace }}
âœ… Chart Version: {{ .Chart.Version }}
âœ… App Version: {{ .Chart.AppVersion }}
âœ… Deployment Time: {{ now | date "2006-01-02 15:04:05 UTC" }}

# =============================================================================
# ğŸŒ ACCESS INFORMATION
# =============================================================================

{{- if .Values.ingress.enabled }}
{{- range $host := .Values.ingress.hosts }}
  {{- range .paths }}
ğŸŒ Application URL: {{ if $.Values.ingress.tls }}https{{ else }}http{{ end }}://{{ $host.host }}{{ .path }}
  {{- end }}
{{- end }}
{{- else if contains "NodePort" .Values.service.type }}
ğŸŒ Application URL: Get the application URL by running these commands:
  export NODE_PORT=$(kubectl get --namespace {{ .Release.Namespace }} -o jsonpath="{.spec.ports[0].nodePort}" services {{ $fullName }})
  export NODE_IP=$(kubectl get nodes --namespace {{ .Release.Namespace }} -o jsonpath="{.items[0].status.addresses[0].address}")
  echo http://$NODE_IP:$NODE_PORT
{{- else if contains "LoadBalancer" .Values.service.type }}
ğŸŒ Application URL: Get the application URL by running these commands:
     NOTE: It may take a few minutes for the LoadBalancer IP to be available.
           You can watch the status of by running 'kubectl get --namespace {{ .Release.Namespace }} svc -w {{ $fullName }}'
  export SERVICE_IP=$(kubectl get svc --namespace {{ .Release.Namespace }} {{ $fullName }} --template "{{ "{{" }} range (index .status.loadBalancer.ingress 0) {{ "}}" }}{{ "{{" }}.{{ "}}" }}{{ "{{" }} end {{ "}}" }}")
  echo http://$SERVICE_IP:{{ $svcPort }}
{{- else if contains "ClusterIP" .Values.service.type }}
ğŸŒ Application URL: Get the application URL by running these commands:
  export POD_NAME=$(kubectl get pods --namespace {{ .Release.Namespace }} -l "app.kubernetes.io/name={{ include "security-dashboard.name" . }},app.kubernetes.io/instance={{ .Release.Name }}" -o jsonpath="{.items[0].metadata.name}")
  export CONTAINER_PORT=$(kubectl get pod --namespace {{ .Release.Namespace }} $POD_NAME -o jsonpath="{.spec.containers[0].ports[0].containerPort}")
  echo "Visit http://127.0.0.1:8080 to use your application"
  kubectl --namespace {{ .Release.Namespace }} port-forward $POD_NAME 8080:$CONTAINER_PORT
{{- end }}

# =============================================================================
# ğŸ” AUTHENTICATION & SECURITY
# =============================================================================

{{- if .Values.auth.enabled }}
ğŸ” Authentication is ENABLED
{{- if .Values.auth.defaultAdmin.enabled }}

ğŸ“‹ Default Admin Credentials:
   Username: {{ .Values.auth.defaultAdmin.username | default "admin" }}
   Password: Get the password by running:
   kubectl get secret --namespace {{ .Release.Namespace }} {{ $fullName }}-secret -o jsonpath="{.data.ADMIN_PASSWORD}" | base64 --decode

âš ï¸  IMPORTANT: Please change the default admin password immediately after first login!
{{- end }}

{{- if .Values.auth.oauth.enabled }}
ğŸ”— OAuth Authentication:
{{- range .Values.auth.oauth.providers }}
   - {{ .name | title }}: {{ .enabled | ternary "âœ… Enabled" "âŒ Disabled" }}
{{- end }}
{{- end }}

{{- if .Values.auth.ldap.enabled }}
ğŸ¢ LDAP Authentication: âœ… Enabled
   Server: {{ .Values.auth.ldap.server }}
   Base DN: {{ .Values.auth.ldap.baseDN }}
{{- end }}

{{- if .Values.auth.saml.enabled }}
ğŸ« SAML Authentication: âœ… Enabled
   Entity ID: {{ .Values.auth.saml.entityId }}
   SSO URL: {{ .Values.auth.saml.ssoUrl }}
{{- end }}
{{- else }}
âš ï¸  Authentication is DISABLED - This is not recommended for production!
{{- end }}

# =============================================================================
# ğŸ’¾ DATABASE INFORMATION
# =============================================================================

{{- if .Values.postgresql.enabled }}
ğŸ˜ PostgreSQL Database: âœ… Enabled (Internal)
   Host: {{ include "security-dashboard.databaseHost" . }}
   Port: {{ include "security-dashboard.databasePort" . }}
   Database: {{ .Values.postgresql.auth.database }}
   Username: {{ .Values.postgresql.auth.username }}
{{- else }}
ğŸ˜ PostgreSQL Database: ğŸ”— External
   Host: {{ .Values.externalDatabase.host }}
   Port: {{ .Values.externalDatabase.port }}
   Database: {{ .Values.externalDatabase.database }}
{{- end }}

{{- if .Values.redis.enabled }}
ğŸ”´ Redis Cache: âœ… Enabled (Internal)
   Host: {{ include "security-dashboard.redisHost" . }}
   Port: {{ include "security-dashboard.redisPort" . }}
{{- else if .Values.externalRedis.enabled }}
ğŸ”´ Redis Cache: ğŸ”— External
   Host: {{ .Values.externalRedis.host }}
   Port: {{ .Values.externalRedis.port }}
{{- else }}
ğŸ”´ Redis Cache: âŒ Disabled
{{- end }}

{{- if .Values.mongodb.enabled }}
ğŸƒ MongoDB: âœ… Enabled (Internal)
   Host: {{ include "security-dashboard.mongodbHost" . }}
   Port: {{ include "security-dashboard.mongodbPort" . }}
{{- else if .Values.externalMongodb.enabled }}
ğŸƒ MongoDB: ğŸ”— External
   Host: {{ .Values.externalMongodb.host }}
   Port: {{ .Values.externalMongodb.port }}
{{- else }}
ğŸƒ MongoDB: âŒ Disabled
{{- end }}

# =============================================================================
# ğŸ“ˆ MONITORING & OBSERVABILITY
# =============================================================================

{{- if .Values.monitoring.prometheus.enabled }}
ğŸ“Š Prometheus Monitoring: âœ… Enabled
   Metrics Endpoint: /metrics
   ServiceMonitor: {{ .Values.monitoring.prometheus.serviceMonitor.enabled | ternary "âœ… Created" "âŒ Not Created" }}
{{- else }}
ğŸ“Š Prometheus Monitoring: âŒ Disabled
{{- end }}

{{- if .Values.monitoring.grafana.enabled }}
ğŸ“ˆ Grafana Dashboard: âœ… Enabled
   Dashboard: {{ .Values.monitoring.grafana.dashboard.enabled | ternary "âœ… Imported" "âŒ Not Imported" }}
{{- else }}
ğŸ“ˆ Grafana Dashboard: âŒ Disabled
{{- end }}

{{- if .Values.monitoring.jaeger.enabled }}
ğŸ” Jaeger Tracing: âœ… Enabled
   Endpoint: {{ .Values.monitoring.jaeger.endpoint }}
{{- else }}
ğŸ” Jaeger Tracing: âŒ Disabled
{{- end }}

{{- if .Values.logging.enabled }}
ğŸ“ Centralized Logging: âœ… Enabled
   Level: {{ .Values.logging.level | upper }}
   Format: {{ .Values.logging.format }}
{{- if .Values.logging.elasticsearch.enabled }}
   ElasticSearch: âœ… Connected
{{- end }}
{{- if .Values.logging.fluentd.enabled }}
   Fluentd: âœ… Enabled
{{- end }}
{{- else }}
ğŸ“ Centralized Logging: âŒ Disabled
{{- end }}

# =============================================================================
# ğŸ”„ BACKUP & RECOVERY
# =============================================================================

{{- if .Values.jobs.backup.enabled }}
ğŸ’¾ Automated Backup: âœ… Enabled
   Schedule: {{ .Values.jobs.backup.schedule }}
   Retention: {{ .Values.jobs.backup.retentionDays }} days
   Components:
   {{- if .Values.jobs.backup.database }}
   - Database: âœ… Included
   {{- end }}
   {{- if .Values.jobs.backup.redis }}
   - Redis: âœ… Included
   {{- end }}
   {{- if .Values.jobs.backup.files }}
   - Files: âœ… Included
   {{- end }}
{{- else }}
ğŸ’¾ Automated Backup: âŒ Disabled
{{- end }}

# =============================================================================
# ğŸš€ SCALING & PERFORMANCE
# =============================================================================

{{- if .Values.autoscaling.enabled }}
ğŸ“ˆ Auto Scaling: âœ… Enabled
   Min Replicas: {{ .Values.autoscaling.minReplicas }}
   Max Replicas: {{ .Values.autoscaling.maxReplicas }}
   Target CPU: {{ .Values.autoscaling.targetCPUUtilizationPercentage }}%
   {{- if .Values.autoscaling.targetMemoryUtilizationPercentage }}
   Target Memory: {{ .Values.autoscaling.targetMemoryUtilizationPercentage }}%
   {{- end }}
{{- else }}
ğŸ“ˆ Auto Scaling: âŒ Disabled
   Replicas: {{ .Values.replicaCount }}
{{- end }}

{{- if .Values.websocket.enabled }}
ğŸ”Œ WebSocket Service: âœ… Enabled
   Port: {{ .Values.websocket.service.port }}
   Replicas: {{ .Values.websocket.replicaCount }}
{{- else }}
ğŸ”Œ WebSocket Service: âŒ Disabled
{{- end }}

# =============================================================================
# ğŸ›¡ï¸ SECURITY FEATURES
# =============================================================================

{{- if .Values.security.networkPolicy.enabled }}
ğŸ›¡ï¸  Network Policies: âœ… Enabled
{{- else }}
ğŸ›¡ï¸  Network Policies: âŒ Disabled
{{- end }}

{{- if .Values.security.podSecurityPolicy.enabled }}
ğŸ”’ Pod Security Policy: âœ… Enabled
{{- else }}
ğŸ”’ Pod Security Policy: âŒ Disabled
{{- end }}

{{- if .Values.tls.enabled }}
ğŸ” TLS Encryption: âœ… Enabled
   Certificate: {{ .Values.tls.secretName }}
{{- else }}
ğŸ” TLS Encryption: âŒ Disabled
{{- end }}

{{- if .Values.security.rateLimiting.enabled }}
âš¡ Rate Limiting: âœ… Enabled
   Requests per minute: {{ .Values.security.rateLimiting.requestsPerMinute }}
{{- else }}
âš¡ Rate Limiting: âŒ Disabled
{{- end }}

{{- if .Values.jobs.securityScan.enabled }}
ğŸ” Security Scanning: âœ… Enabled
   Schedule: {{ .Values.jobs.securityScan.schedule }}
{{- else }}
ğŸ” Security Scanning: âŒ Disabled
{{- end }}

# =============================================================================
# ğŸ”§ USEFUL COMMANDS
# =============================================================================

ğŸ“‹ Get Pod Status:
   kubectl get pods -n {{ .Release.Namespace }} -l app.kubernetes.io/instance={{ .Release.Name }}

ğŸ“‹ View Logs:
   kubectl logs -n {{ .Release.Namespace }} -l app.kubernetes.io/instance={{ .Release.Name }} -f

ğŸ“‹ Get Service Information:
   kubectl get svc -n {{ .Release.Namespace }} -l app.kubernetes.io/instance={{ .Release.Name }}

ğŸ“‹ Port Forward (for ClusterIP):
   kubectl port-forward -n {{ .Release.Namespace }} svc/{{ $fullName }} 8080:{{ $svcPort }}

ğŸ“‹ Scale Application:
   kubectl scale deployment -n {{ .Release.Namespace }} {{ $fullName }} --replicas=<number>

ğŸ“‹ Update Configuration:
   helm upgrade {{ .Release.Name }} {{ .Chart.Name }} -n {{ .Release.Namespace }} -f values.yaml

ğŸ“‹ Uninstall:
   helm uninstall {{ .Release.Name }} -n {{ .Release.Namespace }}

# =============================================================================
# ğŸ†˜ TROUBLESHOOTING
# =============================================================================

â“ If pods are not starting:
   1. Check pod status: kubectl describe pod -n {{ .Release.Namespace }} <pod-name>
   2. Check logs: kubectl logs -n {{ .Release.Namespace }} <pod-name>
   3. Verify secrets and configmaps are created
   4. Check resource limits and node capacity

â“ If database connection fails:
   1. Verify database credentials in secrets
   2. Check database service is running
   3. Test network connectivity between pods
   4. Verify database initialization completed

â“ If ingress is not working:
   1. Check ingress controller is installed
   2. Verify DNS resolution
   3. Check TLS certificates if HTTPS is enabled
   4. Verify ingress annotations are correct

â“ If monitoring is not working:
   1. Check Prometheus is scraping metrics
   2. Verify ServiceMonitor is created
   3. Check network policies allow monitoring traffic
   4. Verify metrics endpoint is accessible

# =============================================================================
# ğŸ“š DOCUMENTATION & SUPPORT
# =============================================================================

ğŸ“– Documentation: https://nexus-ide.dev/docs
ğŸ› Issue Tracker: https://github.com/nexus-ide/security-dashboard/issues
ğŸ’¬ Community: https://discord.gg/nexus-ide
ğŸ“§ Support: support@nexus-ide.dev

# =============================================================================
# ğŸ‰ CONGRATULATIONS!
# =============================================================================

ğŸ‰ Your NEXUS IDE Security Dashboard is now ready!

{{- if .Values.development.enabled }}
âš ï¸  DEVELOPMENT MODE is enabled - This should not be used in production!
{{- end }}

{{- if not .Values.auth.enabled }}
âš ï¸  Authentication is disabled - Please enable it for production use!
{{- end }}

{{- if not .Values.tls.enabled }}
âš ï¸  TLS is disabled - Please enable HTTPS for production use!
{{- end }}

Thank you for choosing NEXUS IDE Security Dashboard! ğŸš€

# =============================================================================
# END OF INSTALLATION NOTES
# =============================================================================